<div class="container">
    <form #pessoaForm="ngForm" (ngSubmit)="salvar(pessoaForm)">
        <div class="grid">
            <div class="col-12">
                <h1>{{ editando ? 'Editando' : 'Nova' }} Pessoa</h1>
            </div>

            <div class="col-12 p-fluid field">
                <label for="nome">Nome</label>
                <input pInputText type="text" id="nome" name="nome" #nome="ngModel" [(ngModel)]="pessoa.nome" required minlength="5" placeholder="Digite o nome">
                <app-message [control]="nome.control" error="required" text="Preencha o campo 'Nome'."></app-message>
                 <app-message [control]="nome.control" error="minlength" text="O campo 'Nome' deve ter pelo menos {{ nome.errors?.['minlength']?.requiredLength }} caracteres."></app-message>
            </div>

            <div class="col-12 sm:col-6 md:col-5 p-fluid field">
                <label for="logradouro">logradouro</label>
                <input pInputText type="text" id="logradouro" name="logradouro" #logradouro="ngModel" [(ngModel)]="pessoa.endereco.logradouro" required placeholder="Digite o logradouro"/>
                <app-message [control]="logradouro.control" error="required" text="Preencha o campo 'Logradouro'."></app-message>
            </div>

            <div class="col-12 sm:col-3 md:col-1 p-fluid field">
                <label for="numero">Número</label>
                <input pInputText type="text" id="numero" name="numero" #numero="ngModel" [(ngModel)]="pessoa.endereco.numero" required placeholder="Digite o número"/>
                <app-message [control]="numero.control" error="required" text="Preencha o campo 'Número'."></app-message>
            </div>

            <div class="col-12 sm:col-12 md:col-3 p-fluid field">
                <label for="complemento">Complemento</label>
                <input pInputText type="text" id="complemento" name="Complemento" [(ngModel)]="pessoa.endereco.complemento" placeholder="Digite o complemento"/>
            </div>

            <div class="col-12 sm:col-12 md:col-2 p-fluid field">
                <label for="cep">CEP</label>
                <p-inputMask id="cep" mask="99999-999" name="cep" #cep="ngModel" [(ngModel)]="pessoa.endereco.cep" [required]="true" placeholder="CEP 00000-000"></p-inputMask>
                <app-message [control]="cep.control" error="required" text="Preencha o campo 'CEP."></app-message>
            </div>

            <div class="col-12 sm:col-12 md:col-1 p-fluid field">
                <label for="estado">Estado</label>
                <input pInputText type="text" id="estado" name="estado" #estado="ngModel" [(ngModel)]="pessoa.endereco.estado" required placeholder="Digite a estado"/>
                <app-message [control]="estado.control" error="required" text="Preencha o campo 'Estado'."></app-message>
            </div>

            <div class="col-12 sm:col-12 md:col-6 p-fluid field">
                <label for="bairro">Bairro</label>
                <input pInputText type="text" id="bairro"name="bairro" #bairro="ngModel" [(ngModel)]="pessoa.endereco.bairro" required placeholder="Digite o bairro"/>
                <app-message [control]="bairro.control" error="required" text="Preencha o campo 'Bairro'."></app-message>
            </div>
            
            <div class="col-12 sm:col-12 md:col-6 p-fluid field">
                <label for="cidade">Cidade</label>
                <input pInputText type="text" id="cidade"name="cidade" #cidade="ngModel" [(ngModel)]="pessoa.endereco.cidade" required placeholder="Digite a cidade"/>
                <app-message [control]="cidade.control" error="required" text="Preencha o campo 'Cidade'."></app-message>
            </div>
            
            <p-divider class="col-12" align="center">
                <i class="pi pi-user mr-2 "></i>
                <span class="p-tag mr-2">Contatos &nbsp;</span>
                <p-badge align="rigth" value="+" pTooltip="Adicionar Contato" (click)="preparaNovoContato()" [style]="{cursor: 'pointer'}"></p-badge>
            </p-divider>
        
            <div class="col-12">
                <p-table [value]="pessoa.contatos" [responsive]="true" >
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Nome</th>
                            <th>E-mail</th>
                            <th>Telefone</th>
                            <th></th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-contato let-rowIndex="rowIndex">
                        <tr>
                            <td>{{contato.nome}}</td>
                            <td>{{contato.email}}</td>
                            <td>{{contato.telefone}}</td>
                            <td class="text-center">
                                <a class="pi pi-pencil" style="cursor: pointer;" pTooltip="Editar" tooltipPosition="left" (click)="preparaEdicaoContato(rowIndex)"></a>
                                <span class="p-2"></span>
                                <button style="background-color: white; border: none; cursor: pointer;"><i class="pi pi-trash" pTooltip="Excluir"></i></button>
                              </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td [colSpan]="4">Ainda não existe nenhum contato cadastrado para essa pessoa.</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>

            <div class="col-12 mt-5">
                <p-button [id]="salvar" type="submit" [disabled]="pessoaForm.invalid?true:false">Salvar</p-button>
                <span class="p-2"></span>
                <p-button type="button" (click)="novo(pessoaForm)">Nova</p-button>
                <span class="p-2"></span>
                <a routerLink="/pessoas">Voltar para a pesquisa</a>
            </div>
        </div>
    </form>
</div>

<div class="card flex justify-content-center">
    <p-dialog header="Novo Contato" [(visible)]="exibiContatoForm" [modal]="true" [draggable]="false" [style]="{width: '50vw'}" *ngIf="contato">

        <ng-template pTemplate="header">
            <span class="text-xl font-bold">Novo Contato</span>
        </ng-template>

        <form #contatoForm="ngForm" autocomplete="off">
            <div class="grid">

                <div class="col-12 p-fluid field">
                    <label for="nome">Nome</label>
                    <input pInputText type="text" id="nome" name="nome" #nome="ngModel" [(ngModel)]="contato.nome" required minlength="5" placeholder="Digite o nome do contato.">
                    <app-message [control]="nome.control" error="required" text="Preencha o campo 'Nome'."></app-message>
                    <app-message [control]="nome.control" error="minlength" text="O campo 'Nome' deve ter pelo menos {{ nome.errors?.['minlength']?.requiredLength }} caracteres."></app-message>
                </div>
    
                <div class="col-12 sm:col-12 md:col-6 p-fluid field">
                    <label for="logradouro">E-mail</label>
                    <input pInputText email id="email" name="email" #email="ngModel" [(ngModel)]="contato.email" required placeholder="Digite o e-mail do contato"/>
                   
                    <app-message [control]="email.control" error="required" text="Preencha o campo 'E-mail'."></app-message>
                    <app-message [control]="email.control" error="email" text="Digite um e-mail válido."></app-message>
                </div>
                
                <div class="col-12 sm:col-12 md:col-6 p-fluid field">
                    <label for="numero">Telefone</label>
                    <p-inputMask name="telefone" [required]="true" #telefone="ngModel" [(ngModel)]="contato.telefone" placeholder="(xx) xxxxx-xxxx" mask="(99) 99999-999?9"></p-inputMask>
                    <app-message [control]="telefone.control" error="required" text="Preencha o campo 'Telefone'."></app-message>
                </div>
    
            </div>
        </form>
    
        <ng-template pTemplate="footer">
            <p-button id="salvar-contato"  icon="pi pi-check" [disabled]="contatoForm.invalid?true:false" (click)="adicionarContato(contatoForm, contatoIndex)" label="Adicionar" styleClass="p-button-text"></p-button>
        </ng-template>

    </p-dialog>
</div>